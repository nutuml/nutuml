"use strict";var NutUml;!function(){var v=14,s=v+"px Arial",f=5,u=10,p=5,d=10,c=v+f,g="#9A6A7A",h="#EEEEEE",r="#FEFECE",y="#ffffff",m="#333",x="#A80036";const n="#F6FF70",o="#BA0028";var w=13;const b=12,T=8,X="bold "+b+"px Courier";var k="28px Arial";const M=2,I=3,B=8;const P=13,Y=15,H=40;const W=3,E=5,R=8,C=9,O=20,S=15,N=10,L=5,A=10,F=10,_=["actor","boundary","control","entity","database"],U={actor:{width:34,height:54},boundary:{width:42,height:26},control:{width:26,height:32},entity:{width:24,height:26},database:{width:38,height:50}},z=["hide","autonumber","as","participant","actor","boundary","control","entity","database","collections","title","header","footer","alt","else","opt","loop","par","break","critical","group","end","note","left","right","of","over","ref","activate","deactivate","destroy","box"],D=["participant","actor","boundary","control","entity","database","collections"],j=["title","header","footer","alt","else","opt","loop","par","break","critical","group"],J=["title","note","ref"],Q=["activate","deactivate","destroy"],q=["opt","loop","par","break","critical","group"],G=["-",">","<","->","--\x3e","<-","<--"],K=["->","--\x3e"],V=["<--","--\x3e"],e=[":"],Z=["\r","\n"];function $(e,t){var i=t.cornerY+T,a=t.height-T;t.type==R&&(e.save(),e.beginPath(),e.fillStyle="#fff",e.fillRect(t.x,i,t.width,a),e.fill(),e.restore()),e.save(),e.beginPath(),e.lineWidth=2,e.moveTo(t.toX,i),e.lineTo(t.x,i),e.lineTo(t.x,t.toY),e.stroke(),e.restore(),e.save(),e.beginPath(),e.lineWidth=2,e.shadowBlur=3,e.shadowOffsetX=2,e.shadowOffsetY=2,e.shadowColor=g,e.moveTo(t.toX,i),e.lineTo(t.toX,t.toY),e.lineTo(t.x,t.toY),e.stroke(),e.restore(),e.beginPath();var l=t.typeName;"group"==l&&""!=t.message&&(l=t.message,t.message=""),e.font=X;var n,o=se(e,l,b),r=(r=Math.max(o.width,H))+P+Y,h=o.height,a=t.x+1,o=i+1;e.save(),e.beginPath(),e.fillStyle="#fff",e.moveTo(a,o),e.lineTo(a+r,o),e.lineTo(a+r,o+h/2),e.lineTo(a+r-h/2,o+h),e.lineTo(a,o+h),e.closePath(),e.fill(),e.restore(),e.save(),e.beginPath(),e.moveTo(t.x,i),e.lineTo(t.x+r,i),e.lineTo(t.x+r,i+h/2),e.lineTo(t.x+r-h/2,i+h),e.lineTo(t.x,i+h),e.stroke(),e.beginPath(),e.restore(),t.type!=W&&t.type!=E||""==t.message||(n="["+t.message+"]",fe(e,t.x+r+u,i-2,n,!0)),t.type==R&&(e.font=s,r=se(e,t.message,v),n=t.x+(t.width-r.width)/2,console.log("item.x=",t.x,",txtX=",n,"item.width=",t.width,"txtwidth=",r.width),ue(e,n,o+h+f,t.message,!1)),fe(e,t.x+u,i-2,l,!0)}function ee(e,t){var i=t.cornerY+S,a=t.noteHeight-S-L,l=t.noteItem.color||n;e.save(),e.beginPath(),e.lineWidth=1,e.fillStyle=l,e.strokeStyle=o,e.moveTo(t.noteX,i+a),e.lineTo(t.noteX,i),e.lineTo(t.noteX+t.noteWidth-10,i),e.lineTo(t.noteX+t.noteWidth,i+10),e.lineTo(t.noteX+t.noteWidth,i+a),e.closePath(),e.stroke(),e.fill(),e.restore(),e.save(),e.beginPath(),e.lineWidth=1,e.strokeStyle=o,e.moveTo(t.noteX+t.noteWidth-10,i),e.lineTo(t.noteX+t.noteWidth-10,i+10),e.lineTo(t.noteX+t.noteWidth,i+10),e.closePath(),e.stroke(),e.restore(),e.save(),e.beginPath(),e.lineWidth=1,e.shadowBlur=3,e.shadowOffsetX=2,e.shadowOffsetY=2,e.shadowColor=g,e.strokeStyle=o,e.moveTo(t.noteX+t.noteWidth,i+10),e.lineTo(t.noteX+t.noteWidth,i+a),e.lineTo(t.noteX,i+a),e.stroke(),e.restore(),e.beginPath(),ue(e,t.noteX+N,i,t.noteItem.message,!1)}function i(e,t){e.font=s;for(var i,a,l=t.length,n=0;n<l;n++){var o=t[n];a=void 0,a=u,i=se(i=e,(o=o).title),o.width=i.width+2*a,o.height=i.height,"collections"==o.type&&(o.width+=4,o.height+=4),_.includes(o.type)&&(o.width=i.width,o.height+=U[o.type].height,o.width<U[o.type].width&&(o.width=U[o.type].width))}}function a(e){e.innerHeight=0;for(var t=e.participant.length,i=[],a=e.maxParticipantHeight=0;a<e.lines.length;a++){var l=(u=e.lines[a]).from+"_"+u.to;(void 0===i[l]||i[l]<u.width)&&(i[l]=u.width),i[l]<100&&(i[l]=100),e.innerHeight+=u.height}for(var n=0;n<t;n++)e.maxParticipantHeight=Math.max(e.participant[n].height,e.maxParticipantHeight);for(var o=d+e.titleHeight+e.headerHeight+e.boxHeight,n=0;n<t;n++){var r,h,s,f,u=e.participant[n];0!=n?(h=(r=e.participant[n-1]).name+"_"+u.name,s=u.name+"_"+r.name,f=100,void 0!==i[h]&&(f=Math.max(f,i[h])),void 0!==i[s]&&(f=Math.max(f,i[s])),s=function(e,t,i){if(t<2)return 0;for(var a=e.participant[t-1],l=0,n=e.participant[t],o=0;o<t-1;o++){var r=e.participant[o],h=r.name+"_"+n.name,s=n.name+"_"+r.name,f=0;void 0!==i[h]&&(f=Math.max(f,i[h])),void 0!==i[s]&&(f=Math.max(f,i[s])),f-=a.x-r.x,l=Math.max(l,f)}return l}(e,n,i),f=Math.max(f,s),u.x=r.x+f,u.y=o+e.maxParticipantHeight-u.height,u.lineX=u.x+u.width/2,u.lineY=u.y+u.height):(u.x=d,u.y=o+e.maxParticipantHeight-u.height,u.lineX=u.x+u.width/2,u.lineY=u.y+u.height)}e.height=Math.ceil(e.titleHeight+e.footerHeight+e.headerHeight+e.boxHeight+c+e.innerHeight+2*e.maxParticipantHeight+20),0<e.box.length&&(e.height+=d);var v=e.participant[t-1].width,p=i[e.participant[t-1].name+"_"+e.participant[t-1].name];p&&v/2<p&&(v=v/2+p),e.width=Math.ceil(e.participant[t-1].x+v+d)}function l(e){for(var t,i,a=[],l=d+e.headerHeight+e.boxHeight+e.titleHeight+e.maxParticipantHeight,n=0,o=0,r=0;r<e.lines.length;r++){var h=e.lines[r];if(h.cornerY=l,h.lineY=h.cornerY+(h.height-h.lineHeight)/2,l+=h.height,h.y=l,h.toY=l,h.type==W||h.type==E?(0==a.length&&(i=void 0),a.push(h),t=h):6==h.type?(null!=(t=a.pop())&&(t.toY=l,void 0!==i&&(null==t.x?t.x=i.x-10:t.x=Math.min(t.x,i.x-10),null==t.toX?t.toX=i.toX+20:t.toX=Math.max(t.toX,i.toX+20),n=Math.min(n,t.x),o=Math.max(o,t.toX))),i=t,0<a.length&&(t=a[a.length-1])):4==h.type?h.refItem=t:7==h.type?(h.noteX=function(e,t){for(var i,a,l=0;l<t.participant.length;l++)t.participant[l].name==e.noteItem.participant&&(i=t.participant[l]),t.participant[l].name==e.noteItem.participantTo&&(a=t.participant[l]);return void 0!==a?(a.lineX+i.lineX)/2-e.noteWidth/2:"left"==e.noteItem.direction?i.lineX-e.noteWidth-A:"right"==e.noteItem.direction?i.lineX+A:i.lineX-e.noteWidth/2}(h,e),n=Math.min(n,h.noteX),o=Math.max(o,h.noteX+h.noteWidth+d)):h.type==R&&(h.x=function(e,t){for(var i,a,l=0;l<t.participant.length;l++)t.participant[l].name==e.from&&(i=t.participant[l]),t.participant[l].name==e.to&&(a=t.participant[l]);if(null==i)return 0;{if(void 0===a)return i.lineX-20;var n=Math.abs(a.lineX-i.lineX)+O;return e.width=Math.max(e.width,n),(a.lineX+i.lineX)/2-e.width/2}}(h,e),h.toX=h.x+h.width,h.toY=h.cornerY+h.height,n=Math.min(n,h.x),o=Math.max(o,h.toX+d)),1===h.type){for(var s,f,u,v,p=0;p<e.participant.length;p++)e.participant[p].name==h.from&&(s=e.participant[p]),e.participant[p].name==h.to&&(f=e.participant[p]);h.x=s.lineX,h.toX=f.lineX,null!=h.noteItem&&("left"==h.noteItem.direction?(h.noteX=Math.min(h.x,h.toX)-h.noteWidth-A,n=Math.min(n,h.noteX)):"right"==h.noteItem.direction&&(h.noteX=Math.max(h.x,h.toX)+A,o=Math.max(o,h.noteX+h.noteWidth+d))),null!=t&&(u=Math.min(h.x,h.toX),v=Math.max(h.x,h.toX),null==t.x?t.x=u-30:t.x=Math.min(u-30,t.x),null==t.toX?t.toX=v+20:t.toX=Math.max(v+20,t.toX))}}o+d>e.width&&(e.width=o+d),n<0&&(e.tranlateX=Math.ceil(Math.abs(n)),e.width+=e.tranlateX)}function te(e,t,i,a,l){e.save(),e.beginPath(),e.setLineDash([5,5]),e.moveTo(t,i),e.lineTo(a,l),e.stroke(),e.fill(),e.restore()}function ie(e,t,i,a,l){e.save(),e.beginPath(),e.moveTo(t,i),e.lineTo(a,l),e.stroke(),e.fill(),e.restore()}function ae(e,t){var i,a,l,n;"actor"==t.type?function(e,t){var i=t.x+2,a=t.y;t.isBottom&&(a+=v+p);var l=U.actor.width,n=U.actor.height;t.width>l&&(i=t.x+(t.width-l)/2);e.save(),e.beginPath(),e.lineWidth=2,e.strokeStyle=x,e.fillStyle=r,e.arc(i+15,a+8,8,0,2*Math.PI),e.fill(),e.moveTo(i+15,a+16),e.lineTo(i+15,a+40),e.moveTo(i+2,a+22),e.lineTo(i+28,a+22),e.moveTo(i,a+54),e.lineTo(i+15,a+40),e.lineTo(i+30,a+54),e.stroke(),e.restore(),e.save(),e.beginPath(),e.font=s,e.fillStyle=m,i=t.x;var o=e.measureText(t.title).width;o<l&&(i+=(l-o)/2);t.isBottom?e.fillText(t.title,i,a-p):e.fillText(t.title,i,v+n+t.y);e.fill(),e.stroke(),e.restore()}(e,t):"boundary"==t.type?function(e,t){var i=t.x+1,a=t.y;t.isBottom&&(a+=v+p);var l=U.boundary.width,n=U.boundary.height;t.width>l&&(i=t.x+(t.width-l)/2);e.save(),e.beginPath(),e.lineWidth=2,e.strokeStyle=x,e.fillStyle=r,e.shadowBlur=3,e.shadowOffsetX=4,e.shadowOffsetY=4,e.shadowColor=g,e.moveTo(i,a),e.lineTo(i,a+24),e.moveTo(i,a+12),e.lineTo(i+17,a+12),e.stroke(),e.beginPath(),e.lineWidth=2,e.arc(i+29,a+12,12,0,2*Math.PI),e.stroke(),e.beginPath(),e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0,e.arc(i+29,a+12,11,0,2*Math.PI),e.fill(),e.restore(),e.save(),e.beginPath(),e.font=s,e.fillStyle=m,i=t.x;var o=e.measureText(t.title).width;o<l&&(i+=(l-o)/2);e.fontSize=v,t.isBottom?e.fillText(t.title,i,a-p):e.fillText(t.title,i,v+n+t.y);e.fill(),e.stroke(),e.restore()}(e,t):"control"==t.type?function(e,t){var i=t.x,a=t.y;t.isBottom&&(a+=v+p);var l=U.control.width,n=U.control.height;t.width>l&&(i=t.x+(t.width-l)/2);e.save(),e.lineWidth=2,e.strokeStyle=x,e.fillStyle=r,e.shadowBlur=3,e.shadowOffsetX=4,e.shadowOffsetY=4,e.shadowColor=g,e.beginPath(),e.lineWidth=2,e.arc(i+13,a+19,13,0,2*Math.PI),e.stroke(),e.beginPath(),e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0,e.arc(i+13,a+19,12,0,2*Math.PI),e.fill(),e.beginPath(),e.fillStyle=x,e.moveTo(i+10,a+6),e.lineTo(i+17,a+12),e.lineTo(i+15,a+6),e.lineTo(i+17,a),e.closePath(),e.fill(),e.restore(),e.save(),e.beginPath(),e.font=s,e.fillStyle=m,i=t.x;var o=e.measureText(t.title).width;o<l&&(i+=(l-o)/2);e.fontSize=v,t.isBottom?e.fillText(t.title,i,a-p):e.fillText(t.title,i,v+n+t.y);e.fill(),e.stroke(),e.restore()}(e,t):"entity"==t.type?function(e,t){var i=t.x,a=t.y;t.isBottom&&(a+=v+p);var l=U.entity.width,n=U.entity.height;t.width>l&&(i=t.x+(t.width-l)/2);e.save(),e.lineWidth=2,e.strokeStyle=x,e.fillStyle=r,e.shadowBlur=3,e.shadowOffsetX=4,e.shadowOffsetY=4,e.shadowColor=g,e.beginPath(),e.lineWidth=2,e.arc(i+12,a+12,12,0,2*Math.PI),e.stroke(),e.beginPath(),e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0,e.arc(i+12,a+12,11,0,2*Math.PI),e.fill(),e.beginPath(),e.fillStyle=x,e.moveTo(i,a+25),e.lineTo(i+25,a+25),e.stroke(),e.restore(),e.save(),e.beginPath(),e.font=s,e.fillStyle=m,i=t.x;var o=e.measureText(t.title).width;o<l&&(i+=(l-o)/2);e.fontSize=v,t.isBottom?e.fillText(t.title,i,a-p):e.fillText(t.title,i,v+n+t.y);e.fill(),e.stroke(),e.restore()}(e,t):"database"==t.type?function(e,t){var i=t.x,a=t.y;t.isBottom&&(a+=v+p);var l=U.database.width,n=U.database.height;t.width>l&&(i=t.x+(t.width-l)/2);e.save(),e.lineWidth=2,e.strokeStyle=x,e.fillStyle=r,e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowColor=g,e.beginPath(),e.fillRect(t.x,a+11,38,28),e.fill(),e.lineWidth=2,e.ellipse(i+19,a+11,19,11,0,0,2*Math.PI),e.ellipse(i+19,a+39,19,11,0,0,Math.PI),e.moveTo(i,a+11),e.lineTo(i,a+39),e.moveTo(i+38,a+11),e.lineTo(i+38,a+39),e.fill(),e.stroke(),e.beginPath(),e.strokeStyle=x,e.fillStyle=r,e.shadowBlur=3,e.shadowOffsetX=2,e.shadowOffsetY=3,e.shadowColor=g,e.moveTo(i+38,a+11),e.lineTo(i+38,a+39),e.ellipse(i+19,a+39,19,11,0,0,Math.PI),e.stroke(),e.restore(),e.save(),e.beginPath(),e.font=s,e.fillStyle=m,i=t.x;var o=e.measureText(t.title).width;o<l&&(i+=(l-o)/2);e.fontSize=v,t.isBottom?e.fillText(t.title,i,a-p):e.fillText(t.title,i,v+n+t.y);e.fill(),e.stroke(),e.restore()}(e,t):"collections"==t.type?(i=e,l=(a=t).height-4,n=a.width-4,i.save(),i.beginPath(),i.shadowBlur=3,i.shadowOffsetX=4,i.shadowOffsetY=4,i.shadowColor=g,i.fillStyle=r,i.fillRect(a.x+4,a.y,n,l),i.shadowOffsetX=0,i.shadowOffsetY=0,i.shadowBlur=1,i.fillRect(a.x+4,a.y,n,l),i.strokeStyle=x,i.strokeRect(a.x+4,a.y,n,l),i.stroke(),i.fill(),i.beginPath(),i.shadowBlur=3,i.shadowOffsetX=4,i.shadowOffsetY=4,i.fillRect(a.x,a.y+4,n,l),i.shadowOffsetX=0,i.shadowOffsetY=0,i.shadowBlur=1,i.fillRect(a.x,a.y+4,n,l),i.strokeStyle=x,i.strokeRect(a.x,a.y+4,n,l),i.stroke(),i.fill(),i.restore(),ue(i,a.x+u,a.y+4,a.title,!0)):(t=t,(e=e).save(),e.beginPath(),e.shadowBlur=3,e.shadowOffsetX=4,e.shadowOffsetY=4,e.shadowColor=g,e.fillStyle=r,e.fillRect(t.x,t.y,t.width,t.height),e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=1,e.fillRect(t.x,t.y,t.width,t.height),e.strokeStyle=x,e.strokeRect(t.x,t.y,t.width,t.height),e.stroke(),e.fill(),e.restore(),ue(e,t.x+u,t.y,t.title,!0))}function le(e,t){var i,a,l,n,o;if(0<t.titleHeight&&(e.font=k,l=se(e,t.title,28),n=(t.width-l.width)/2,i=e,a=n,l=d+t.headerHeight,n=t.title,i.save(),i.font=k,i.fillStyle=m,ve(i,a,l,n,v),i.fill(),i.restore()),0<t.headerHeight&&(e.font=s,o=se(e,t.header),ue(e,t.width-d-o.width,d,t.header,!1)),0<t.footerHeight&&(e.font=s,o=se(e,t.footer),ue(e,t.width-d-o.width,t.height-t.footerHeight,t.footer,!1)),0<t.box.length)for(var r=0;r<t.box.length;r++)!function(e,t){e.save(),e.beginPath(),e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=1,e.fillStyle=h,null!=t.color&&(e.fillStyle=t.color),e.fillRect(t.x,t.y,t.width,t.height),e.strokeStyle=x,e.strokeRect(t.x,t.y,t.width,t.height),e.stroke(),e.fill(),e.restore(),e.save(),e.font=s,e.fillStyle=m;var i=se(e,t.title);ve(e,t.x+(t.width-i.width)/2,t.y,t.title,v,!0),e.fill(),e.restore()}(e,t.box[r])}function ne(e,t){for(var i=t.participant.length,a=function(e){for(var t=e.lines.length,i=[],a=0;a<t;a++){var l=e.lines[a];l.type==C&&i.push({from:l.cornerY,to:l.cornerY+l.height})}return i}(t),l=0;l<i;l++){var n,o=t.participant[l];"["!=o.name&&"]"!=o.name&&(ae(e,o),(n=function(e){var t,i={};for(t in e)e.hasOwnProperty(t)&&(i[t]=e[t]);return i}(o)).y=o.y+t.innerHeight+c+o.height,n.isBottom=!0,t.hideFootbox||ae(e,n),0<a.length?function(e,t,i,a,l,n){ie(e,t,i,a,n[0].from+10);for(var o,r,h,s,f,u=0;u<n.length;u++)1<=u&&ie(e,t,n[u-1].to+10,a,n[u].from+10),o=e,r=t,h=n[u].from+10,s=a,f=n[u].to+10,o.save(),o.beginPath(),o.setLineDash([1,4]),o.moveTo(r,h),o.lineTo(s,f),o.stroke(),o.fill(),o.restore();ie(e,t,n[n.length-1].to+10,a,l)}(e,o.lineX,o.lineY,o.lineX,n.y,a):te(e,o.lineX,o.lineY,o.lineX,n.y))}}function oe(e,t){for(var i=0;i<t.activeLines.length;i++)!function(e,t){e.save(),e.beginPath(),e.shadowBlur=3,e.shadowOffsetX=4,e.shadowOffsetY=4,e.shadowColor=g;var i=t.x-F/2,a=t.topY,l=F,t=t.bottomY-t.topY;e.fillStyle="#ffffff",e.fillRect(i,a,l,t),e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=1,e.fillRect(i,a,l,t),e.strokeStyle=x,e.strokeRect(i,a,l,t),e.stroke(),e.fill(),e.restore()}(e,t.activeLines[i])}function re(e,t){for(var i,a,l,n=t.lines.length,o=0;o<n;o++){var r=t.lines[o];1==r.type?function(e,t,i){null!=t.noteItem&&ee(e,t);var a=t.message;i.autonumber&&(a=t.number+" "+a);se(e,t.message);t.from!=t.to?(ue(e,Math.min(t.x,t.toX)+10,t.lineY+p,a),(V.includes(t.operator)?te:ie)(e,t.x,t.lineY+t.lineHeight,t.toX,t.lineY+t.lineHeight),he(e,t.toX,t.lineY+t.lineHeight,t.x>t.toX)):(ue(e,Math.min(t.x,t.toX)+10,t.lineY+p,a),function(e,t,i){e.save(),e.beginPath(),e.moveTo(t,i),e.lineTo(t+40,i),e.lineTo(t+40,i+13),e.lineTo(t,i+13),e.stroke(),e.restore(),he(e,t,i+13,!0)}(e,t.x,t.lineY+t.lineHeight-w))}(e,r,t):2==r.type?function(e,t,i){e.save(),e.beginPath();var a=t.y-t.height/2+p,l=i.width/2-t.width/2,n=se(e,t.message),o=a-n.height/2,r=n.height,n=a-2,a=a+2;e.fillStyle=y,e.fillRect(0,n,i.width,4),e.fill(),e.moveTo(0,n),e.lineTo(i.width,n),e.moveTo(i.width,a),e.lineTo(0,a),e.stroke(),e.beginPath(),e.shadowBlur=3,e.shadowOffsetX=4,e.shadowOffsetY=4,e.shadowColor=g,e.fillStyle=y,e.fillRect(l,o,t.width,r),e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=1,e.fillRect(l,o,t.width,r),e.strokeStyle=x,e.strokeRect(l,o,t.width,r),e.stroke(),e.restore(),ue(e,l+u,o-2,t.message)}(e,r,t):4==r.type?function(e,t){var i="["+t.message+"]",a=se(e,t.message);fe(e,Math.min(t.refItem.x,t.refItem.toX)+10,t.y-a.height,i);i=t.cornerY+7;te(e,t.refItem.x,i,t.refItem.toX,i)}(e,r):7==r.type?ee(e,r):r.type==R?$(e,r):r.type==C&&(i=e,a=r,l=t.width,r=void 0,""!=a.message.trim()&&(r=se(i,a.message,v),r=(l-r.width)/2-N,ue(i,r,a.lineY+20,a.message)))}}function he(e,t,i,a){var l=-12,n=-7,o=-5;a&&(l=0-l,n=0-n,o=0-o),e.save(),e.beginPath(),e.moveTo(t,i),e.lineTo(t+l,i+o),e.lineTo(t+n,i),e.lineTo(t+l,i-o),e.lineTo(t,i),e.stroke(),e.fill(),e.restore()}function se(t,e,i){i=i||v;var a={width:0,height:0},e=e.split("\n");return e.forEach(function(e){a.width=Math.max(a.width,t.measureText(e).width)}),a.height=e.length*(i+p)+p,a}function fe(e,t,i,a,l){e.save(),e.font=X,e.fillStyle=m,ve(e,t,i,a,v,l),e.fill(),e.restore()}function ue(e,t,i,a,l){e.save(),e.font=s,e.fillStyle=m,ve(e,t,i,a,v,l),e.fill(),e.restore()}function ve(e,t,i,a,l,n){var o=l||v,r=a.split("\n"),h=null;n&&(h=se(e,a));for(var s=0;s<r.length;s++){var f=t,u=i+s*(o+p);n&&(f=t+(h.width-e.measureText(r[s]).width)/2),e.fillText(r[s],f,o+u+p-1)}}function pe(e,t,i){return{from:"",to:"",message:t,operator:"",number:0,type:e,typeName:i,active:[]}}function de(e){for(var t,i,a={participant:[],box:[],lines:[],activeLines:[],innerHeight:0,width:0,height:0,title:"",header:"",footer:"",headerHeight:0,boxHeight:0,titleHeight:0,footerHeight:0,autonumber:!1,hideFootbox:!1},l=e.length,n=0,o=[],r=1,h=!1;n<l;){var s=e[n++];if(1==s.type){if("ref"==s.value){n=function(e,t,i){var a=e.length;if(i+5<a){var l=e[i+1],n=e[i+3],o=e[i+5];if("over"==e[i].value&&l.type==M&&e[i+2].type==B&&n.type==M&&":"==e[i+4].value&&o.type==I)return(r=pe(R,o.value,"REF")).from=l.value,r.to=n.value,t.lines.push(r),i+6}if(i+3<a){l=e[i+1],o=e[i+3];if("over"==e[i].value&&l.type==M&&":"==e[i+2].value&&o.type==I)return(r=pe(R,o.value,"REF")).from=l.value,t.lines.push(r),i+4}if(i+4<a){l=e[i+1],o=e[i+2];if("over"==e[i].value&&l.type==M&&o.type==I&&"end"==e[i+3].value&&"ref"==e[i+4].value)return(r=pe(R,o.value,"REF")).from=l.value,t.lines.push(r),i+5}if(i+6<a){var r,l=e[i+1],n=e[i+3],o=e[i+4];if("over"==e[i].value&&l.type==M&&e[i+2].type==B&&l.type==M&&o.type==I&&"end"==e[i+5].value&&"ref"==e[i+6].value)return(r=pe(R,o.value,"REF")).from=l.value,r.to=n.value,t.lines.push(r),i+7}}(e,a,n);continue}if("box"==s.value){if(n+1<l){var f=e[n],u=e[n+1];if(u.type==M&&s.line==f.line&&s.line==u.line){a.box.push({title:f.value,color:u.value,start:null,end:null}),n+=2,h=!0;continue}if(s.line==f.line){a.box.push({title:f.value,color:null,start:null,end:null}),n+=1,h=!0;continue}}a.box.push({title:"",color:null,start:null,end:null}),h=!0;continue}if("note"==s.value){if(n+2<l){var v=e[n],p=e[n+1],d=e[n+2];if(("left"==v.value||"right"==v.value)&&":"==p.value&&d.type==I){var c={direction:v.value,message:d.value};n+=3,0<a.lines.length&&(a.lines[a.lines.length-1].noteItem=c);continue}}if(n+3<l){v=e[n],d=e[n+1];if(("left"==v.value||"right"==v.value)&&d.type==I&&"end"==e[n+2].value&&"note"==e[n+3].value){c={direction:v.value,message:d.value};n+=4,0<a.lines.length&&(a.lines[a.lines.length-1].noteItem=c);continue}}if(n+6<l){var v=e[n],g=e[n+1],y=e[n+2],m=e[n+3],d=e[n+4];if(("left"==v.value||"right"==v.value)&&"of"==g.value&&y.type==M&&d.type==I&&"end"==e[n+5].value&&"note"==e[n+6].value){c={direction:v.value,message:d.value,color:m.value,participant:y.value};n+=7,(X=pe(7,"","ONLY_NOTE")).noteItem=c,a.lines.push(X);continue}}if(n+4<l){var v=e[n],g=e[n+1],y=e[n+2],x=e[n+3],d=e[n+4];if(("left"==v.value||"right"==v.value)&&"of"==g.value&&y.type==M&&5==x.type&&d.type==I){c={direction:v.value,message:d.value,participant:y.value};n+=5,(X=pe(7,"","ONLY_NOTE")).noteItem=c,a.lines.push(X);continue}}if(n+3<l){var w=e[n],y=e[n+1],x=e[n+2],d=e[n+3];if("over"==w.value&&y.type==M&&5==x.type&&d.type==I){c={direction:w.value,message:d.value,participant:y.value};n+=4,(X=pe(7,"","ONLY_NOTE")).noteItem=c,a.lines.push(X);continue}}if(n+6<l){var w=e[n],y=e[n+1],b=e[n+2],T=e[n+3],m=e[n+4],x=e[n+5],d=e[n+6];if("over"==w.value&&y.type==M&&b.type==B&&T.type==M&&5==x.type&&d.type==I){c={direction:w.value,message:d.value,participant:y.value,color:m.value,participantTo:T.value};n+=7,(X=pe(7,"","ONLY_NOTE")).noteItem=c,a.lines.push(X);continue}}if(n+6<l){w=e[n],y=e[n+1],b=e[n+2],T=e[n+3],d=e[n+4];if("over"==w.value&&y.type==M&&b.type==B&&T.type==M&&d.type==I&&"end"==e[n+5].value&&"note"==e[n+6].value){var X,c={direction:w.value,message:d.value,participant:y.value,participantTo:T.value};n+=7,(X=pe(7,"","ONLY_NOTE")).noteItem=c,a.lines.push(X);continue}}}if("autonumber"==s.value){a.autonumber=!0;continue}if("title"==s.value&&(P=e[n++]).type==I&&(a.title=P.value),i=s.value,Q.includes(i)){t=a,u=e,S=n,p=s.value,i=O=void 0,O=u[S++],n=void 0!==(i=u[S])&&(void 0!==(u=i.value)&&"#"===u[0])?(0<t.lines.length&&t.lines[t.lines.length-1].active.push({type:p,participant:O.value,color:i.value}),S+1):(O.type==M&&0<t.lines.length&&t.lines[t.lines.length-1].active.push({type:p,participant:O.value}),S);continue}if("header"==s.value&&(P=e[n++]).type==I&&(a.header=P.value),"footer"==s.value&&(P=e[n++]).type==I&&(a.footer=P.value),"hide"==s.value){"footbox"==e[n].value&&(a.hideFootbox=!0,n++);continue}if("alt"==s.value){var k="";n<l&&(f=e[n]).type==I&&(k=f.value,n++),a.lines.push(pe(W,k,s.value));continue}if("else"==s.value){k="";n<l&&(f=e[n]).type==I&&(k=f.value,n++),a.lines.push(pe(4,k,s.value));continue}if("end"==s.value){if(l<=n){a.lines.push(pe(6,"",s.value));continue}if("box"==(f=e[n]).value){h=!1,n++;continue}a.lines.push(pe(6,"",s.value));continue}if(q.includes(s.value)){k="";n<l&&(f=e[n]).type==I&&(k=f.value,n++),a.lines.push(pe(E,k,s.value));continue}if(D.includes(s.value)){var P=e[n++];if(n+1<l){var Y=e[n],H=e[n+1];if(P.type==M&&"as"==Y.value&&6==H.type){a.participant.push({name:P.value,title:H.value,type:s.value}),o.push(P.value),ce(a,h,P.value),n+=2;continue}if(6==P.type&&"as"==Y.value&&H.type==M){a.participant.push({name:H.value,title:P.value,type:s.value}),o.push(H.value),ce(a,h,H.value),n+=2;continue}}if(P.type==M){a.participant.push({name:P.value,title:P.value,type:s.value}),o.push(P.value),ce(a,h,P.value);continue}}}if(9!=s.type)if(10!=s.type){if(s.type==M||6==s.type||7==s.type){var O=pe(1,"","SEQUENCE");if(7!=s.type){if(o.includes(s.value)||(a.participant.push({name:s.value,title:s.value,type:"participant"}),o.push(s.value)),l<=n)break;if(4!=(P=e[n++]).type)return a.error=s,a;if(l<=n)break;O.operator=P.value;var S=e[n++],Y={name:S.value,title:S.value,type:"participant"};n<l&&(1==(H=e[n]).type&&"as"==H.value&&(n++,(S=e[n++]).type==M?Y.name=S.value:6==S.type&&(Y.title=S.value),n<l&&(H=e[n])),5!=H.type||(H=e[++n]).type==I&&(O.message=H.value)),o.includes(Y.name)||(a.participant.push(Y),o.push(Y.name)),K.includes(P.value)?(O.from=s.value,O.to=Y.name):(O.from=Y.name,O.to=s.value),O.number=r++,a.lines.push(O)}else O.type=2,O.message=s.value,a.lines.push(O)}}else a.lines.push(pe(10,s.value,"SPACE"));else a.lines.push(pe(C,s.value,"DELAY"))}return function(e){for(var t=[],i=null,a=null,l=0;l<e.participant.length;l++){var n=e.participant[l];"["==n.name?i=n:"]"==n.name?a=n:t.push(n)}null!=a&&t.push(a);null!=i&&t.unshift(i);e.participant=t}(a),a}function ce(e,t,i){t&&(null==(e=e.box[e.box.length-1]).start&&(e.start=i),e.end=i)}function ge(e,t){var i=t[e.from],t=t[e.to];""===e.from&&""===e.to||(e.from===e.to&&void 0!==i&&0<i.length&&(e.x+=i.length*F/2,e.toX+=t.length*F/2),e.x<e.toX?(void 0!==i&&0<i.length&&(e.x+=i.length*F/2),void 0!==t&&0<t.length&&(e.toX=e.toX+(t.length-2)*F/2)):e.x>e.toX&&(void 0!==i&&0<i.length&&(e.x+=i.length*F/2),void 0!==t&&0<t.length&&(e.toX+=F/2)))}function ye(e,t,i,a){var l=e.active[i],n=t[l.participant],i=function(e,t){for(var i=0;i<e.participant.length;i++)if(t==e.participant[i].name)return e.participant[i]}(a,l.participant);if(void 0!==i){a=e.y;if("activate"==l.type)void 0===n||0==n.length?((n=[]).push({x:i.lineX,topY:a}),t[l.participant]=n):(i=n[n.length-1].x+F/2,n.push({x:i,topY:a})),ge(e,t);else{ge(e,t);n=n.pop();if(void 0!==n)return n.bottomY=a,n.type=l.type,n}}else console.log("undefined"+l.participant)}function me(e){var t=/[a-z0-9]/i.test(e);return t||"#"==e||"["==e||"]"==e||255<e.charCodeAt(0)}(NutUml=function(e){(this.el=e).innerHTML="";var t=document.createElement("canvas");this.context=t.getContext("2d");var i=document.createElement("img"),a=document.createElement("div");a.style="background-color: #fcf8e3;",e.appendChild(a),e.appendChild(i),this.img=i,this.message=a,this.canvas=t,this.tokens=[],this.debug=!1}).prototype.drawUml=function(e){var t=this.analysis(e);if(this.debug&&console.log(t),!(t instanceof Array))return t;this.tokens=t;e=de(this.tokens);if(this.debug&&console.log(e),void 0!==e.error)return console.log("error"+JSON.stringify(e.error)),this.message.innerText='Syntax error near "'+e.error.value+'" at line '+e.error.line,this.message.style='background-color: #fcf8e3; padding:15px; font-family: "Helvetica Neue",Helvetica,Arial,sans-serif; font-size: 14px; line-height: 1.42857143; color: #333;',"";this.message.innerText="",this.message.style="";t=this.context;return t.lineWidth=1,function(e,t){var i,a;if(0<t.title.length&&(i=se(e,t.title,28),t.titleHeight=i.height),0<t.header.length&&(a=se(e,t.header),t.headerHeight=a.height),0<t.footer.length&&(a=se(e,t.footer),t.footerHeight=a.height),0<t.box.length)for(var l=0;l<t.box.length;l++){var n=t.box[l];null!=n.title&&0<n.title.length&&(n=se(e,n.title),t.boxHeight=Math.max(t.boxHeight,n.height))}}(t,e),i(t,e.participant),function(e,t){e.font=s;for(var i=t.lines,a=i.length,l=u,n=0;n<a;n++){var o,r=i[n],h=se(e,r.message);r.width=h.width+2*l,t.autonumber&&(o=se(e,"99 "),r.width+=o.width),r.type==W||r.type==E?r.height=h.height+f:r.type==R?(r.height=h.height+f+36,r.width=Math.max(r.width,100)):6==r.type?r.height=10:10==r.type?(o=parseInt(r.message),r.height=0<o?o:h.height):r.type==C?""==r.message.trim()?r.height=25:r.height=40:r.height=h.height+f,r.from==r.to&&1==r.type&&(r.height+=w),r.lineHeight=r.height,null!=r.noteItem&&(h=se(e,r.noteItem.message),r.noteWidth=h.width+N+15,r.noteHeight=h.height+S+L,r.height=Math.max(r.lineHeight,r.noteHeight))}}(t,e),a(e),l(e),function(e){for(var t=[],i=0;i<e.lines.length;i++){var a=e.lines[i];if(0<a.active.length)for(var l=0;l<a.active.length;l++){var n=ye(a,t,l,e);void 0!==n&&e.activeLines.push(n)}else ge(a,t)}e.activeLines.reverse()}(e),function(e){if(0!=e.box.length)for(var t=0;t<e.box.length;t++){for(var i=e.box[t],a=i.x=0;a<e.participant.length;a++)if((l=e.participant[a]).name==i.start){i.x=l.x-d;break}for(var l,n=0,a=0;a<e.participant.length;a++)if((l=e.participant[a]).name==i.end){n=l.x-i.x+l.width+d;break}i.y=e.titleHeight+e.headerHeight,i.width=n,i.height=e.height-e.titleHeight-e.headerHeight-e.footerHeight-d}}(e),this.canvas.width=e.width,this.canvas.height=e.height,t.translate(.5,.5),le(t,e),null!=e.tranlateX&&t.translate(e.tranlateX,.5),ne(t,e),function(e,t){for(var i=t.lines.length,a=0;a<i;a++){var l=t.lines[a];l.type!=W&&l.type!=E||$(e,l)}}(t,e),oe(t,e),re(t,e),this.img.src=this.canvas.toDataURL(),""},NutUml.prototype.analysis=function(t){let i=0,a=[];for(var l=!1,n=!1,o=1;i<t.length;){if(Z.includes(t[i])&&1==l&&(o++,l=!(n=!0),i++),n){for(var r="",h=!0,s=o;i<t.length;)if(h)if(me(t[i])){let e=""+t[i++];for(;i<t.length&&me(t[i]);)e+=t[i++];if("end"==e){n=!1,a.push({type:I,value:r.trimEnd(),line:s}),a.push({type:1,value:e,line:o});break}r+=e,h=!1}else r+=t[i++];else Z.includes(t[i])&&(h=!0,o++),r+=t[i++];n=!1}if(/\s/.test(t[i]))"\n"==t[i]&&o++,i++;else if(me(t[i])){let e=""+t[i++];for(;i<t.length&&me(t[i]);)e+=t[i++];if(z.includes(e)){if(a.push({type:1,value:e,line:o}),J.includes(e)&&(a.length<2||"end"!=a[a.length-2].value)&&(l=!0),j.includes(e)){for(;i<t.length&&/\s/.test(t[i])&&!Z.includes(t[i]);)i++;for(var f="";i<t.length&&!Z.includes(t[i]);)f+=t[i++],l=!1;a.push({type:I,value:f,line:o})}}else a.push({type:M,value:e,line:o})}else if(e.includes(t[i])){l=!1,a.push({type:5,value:t[i++],line:o});let e="";for(;i<t.length&&" "==t[i];)i++;for(;i<t.length&&!Z.includes(t[i]);)e+=t[i++];e=e.replace(/\\n/g,"\n"),a.push({type:I,value:e,line:o})}else if(","==t[i])a.push({type:B,value:t[i++],line:o});else if("."==t[i]){r="";if(!(i+2<t.length&&"."==t[i+1]&&"."==t[i+2]))return"syntax error";for(i+=3;i<t.length;){if("."==t[i]&&i+2<t.length&&"."==t[i+1]&&"."==t[i+2]){i+=3;break}if("\n"==t[i])break;r+=t[i++]}a.push({type:9,value:r,line:o})}else if("|"==t[i]){r="";if(i+2<t.length&&"|"==t[i+1]&&"|"==t[i+2])i+=3;else{if(!(i+1<t.length&&"|"==t[i+1]))return"syntax error";for(i+=2;i<t.length;){if("|"==t[i]&&i+1<t.length&&"|"==t[i+1]){i+=2;break}if("\n"==t[i])break;r+=t[i++]}}a.push({type:10,value:r,line:o})}else if(G.includes(t[i])){let e=""+t[i++];for(;i<t.length&&G.includes(t[i]);)e+=t[i++];a.push({type:4,value:e,line:o})}else if('"'==t[i]){let e="";for(i++;i<t.length;){if('"'==(u=t[i++]))break;e+=u}e=e.replace("\\n","\n"),a.push({type:6,value:e,line:o})}else{if("="!=t[i])return"syntax error："+t[i];if(i++,"="!=t[i])return"syntax error";var u,r="";for(i++;i<t.length;){if("="==(u=t[i++])&&i<t.length&&"="==t[i]){i++;break}r+=u}a.push({type:7,value:r,line:o})}}return this.tokens=a,a}}(),"undefined"!=typeof module&&"object"==typeof exports&&(module.exports=NutUml);